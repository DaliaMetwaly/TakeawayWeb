@model Takeaway.Models.TakeawayUser
<style>
    #description {
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
    }

    #infowindow-content .title {
        font-weight: bold;
    }

    #infowindow-content {
        display: none;
    }

    #map #infowindow-content {
        display: inline;
    }

    .pac-card {
        margin: 10px 10px 0 0;
        border-radius: 2px 0 0 2px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        outline: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        background-color: #fff;
        font-family: Roboto;
    }

    #pac-container {
        padding-bottom: 12px;
        margin-right: 12px;
    }

    .pac-controls {
        display: inline-block;
        padding: 5px 11px;
    }

        .pac-controls label {
            font-family: Roboto;
            font-size: 13px;
            font-weight: 300;
        }

    #pac-input {
        background-color: #fff;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        margin-left: 12px;
        padding: 0 11px 0 13px;
        text-overflow: ellipsis;
        width: 400px;
    }

        #pac-input:focus {
            border-color: #4d90fe;
        }

    #title {
        color: #fff;
        background-color: #4d90fe;
        font-size: 25px;
        font-weight: 500;
        padding: 6px 12px;
    }

    #target {
        width: 345px;
    }
    table td {
  position: relative;
    }
    table td input {
  position: absolute;
  display: block;
  top:0;
  left:0;
  margin: 0;
  height: 100%;
  width: 100%;
  border: none;
  padding: 10px;
  box-sizing: border-box
}

   /*.inputcss {display: block; padding: 0; margin: 0; border: 0; width: 100%;}*/
    td {margin: 0; padding: 0;}

</style>
<div class="page-content" style="min-height: 1119px">
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <i class="fa fa-home"></i>
                <a href="~/Home/index">الرئيسية</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <a href="/TakeawayUsers/Index"> صلاحيات المستخدمين</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                تعديل مستخدم
            </li>
        </ul>
    </div>
    <div id="divMsg">@Html.Raw(ViewBag.Msg)</div>
    <div class="portlet box grey-salsa">
        <div class="portlet-title">
            <div class="caption">
                تعديل مستخدم
            </div>
            <div class="tools">
                <a href="javascript:;" class="collapse" data-original-title="" title=""></a>
            </div>
        </div>
        <div class="portlet-body form">
             @using (Html.BeginForm())
             {
             @Html.AntiForgeryToken()
            @Html.ValidationSummary(false, "", new { @class = "Metronic-alerts alert alert-danger fade in", @id = "ValidationMsg" })
            @Html.HiddenFor(model => model.ID, new { @id = "HiddenUserID" })
            @*@Html.ValidationSummary(false, "", new { @class = "Metronic-alerts alert alert-danger fade in" })*@
            <div class="row">
                <div class="col-md-12 ">
                    <div class="form-body">

                        <div class="form-group">
                            @Html.LabelFor(model => model.ContactName, htmlAttributes: new { @class = "col-md-2 control-label" })
                            <div class="input-group col-md-4">
                                @Html.EditorFor(model => model.ContactName, new { htmlAttributes = new { @class = "form-control" } })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.UserName, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="input-group col-md-4">
                                @Html.EditorFor(model => model.UserName, new { htmlAttributes = new { @class = "form-control" } })
                              
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(model => model.ContactPhone, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="input-group col-md-4">
                                @Html.EditorFor(model => model.ContactPhone, new { htmlAttributes = new { @class = "form-control" } })
                               
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.ContactEmail, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="input-group col-md-4">
                                @Html.EditorFor(model => model.ContactEmail, new { htmlAttributes = new { @class = "form-control" } })
                              
                            </div>
                        </div>


                      

                        @*<div class="form-group">
                            <div class="col-md-2">

                            </div>
                            <div class="input-group col-md-4">
                                <div class="md-checkbox">
                                    @Html.CheckBoxFor(model => model.IsActive, new { @class = "md-check" })
                                    <label for="IsActive">
                                        التفعيل
                                        <span class="inc"></span>
                                        <span class="check"></span>
                                        <span class="box"></span>
                                    </label>
                                </div>
                                <span class="input-group-addon input-circle-right">
                                </span>
                                </div>
                                
                            </div>*@

                        @*<div class="form-group">
                            @Html.LabelFor(model => model.PayTypeID, "طريقه الدفع", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="input-group col-md-6">
                                @Html.DropDownListFor(model => model.PayTypeID,ViewBag.PayTypeID as List<SelectListItem>, "اختر", new { @class = "form-control select2me" })
                              
                            </div>
                        </div>*@

          

                    

                        <div class="form-group">
                            @Html.LabelFor(model => model.RoleID, "الصلاحيه", new { @class = "col-md-2 control-label " })
                            <div class="input-group col-md-6">
                                @Html.DropDownListFor(model => model.RoleID, ViewBag.RoleId as List<SelectListItem>, "اختر", new { @class = "form-control select2me", @id = "Roleddl", @onchange = "ChangeRole()" })
                            </div>
                        </div>




                        <div id="UserDataDiv">
                           
                            <div class="portlet box green">
                                <div class="portlet-title">
                                    <div class="caption">
                                        <i class="fa fa-gift"></i> بيانات المستخدم
                                    </div>
                                    <div class="tools">
                                        <a href="" class="collapse">
                                        </a>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <div class="form-body">
                                        <div class="cold-md-12">

                                            <div class="row">
                                                <div class="form-group col-md-4"  style="width:20%;">
                                                    @Html.Label("المنطقة", htmlAttributes: new { @class = "control-label col-md-4", @style = "width:90%" })
                                                    <div class="input-group col-md-6" style="width:100%;">
                                                        @Html.DropDownList("RegionN", ViewBag.RegionN as List<SelectListItem>, "اختر", new { @class = "form-control select2me" })
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4"  style="width:20%;">
                                                    @Html.Label("العنوان", htmlAttributes: new { @class = "control-label col-md-4", @style = "width:90%" })
                                                    <div class="input-group col-md-6" style="width:100%;">
                                                        @Html.TextBox("GAddress", null, new
                                                   {
                                                       @class = "form-control "@*, @onkeyup = "countMMSChar(this)"*@ })
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4"  style="width:20%;">
                                                    @Html.Label("خط العرض", htmlAttributes: new { @class = "control-label col-md-4", @style = "width:92%" })
                                                    <div class="input-group col-md-6" style="width:100%;">
                                                        @Html.TextBox("GMapLutitude", null, new { @class = "form-control ", disabled = "disabled" })
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4"  style="width:20%;">
                                                    @Html.Label("خط الطول", new { @class = "control-label col-md-4", @style = "width:90%" })
                                                    <div class="input-group col-md-6" style="width:100%;">
                                                        @Html.TextBox("GMapLogitude", null, new { @class = "form-control ", disabled = "disabled" })
                                                    </div>
                                                </div>
                                               
                                            </div>

                                            <div class="row">
                                                <input id="pac-input" class="control" type="text" placeholder="بحث">
                                                <div id="map" style="width: 100%; height: 300px">
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-offset-5 col-md-1" style="margin-right:44%;">
                                                    <input value="Add" id="btnAddEditUserData" name="btnAddEditUserData" type="button" class="btn blue-madison btn-default bt" style="margin-top:22px" />
                                                </div>
                                            </div>


                                                <div id="tableholderUserData">

                                                </div>

                                            </div>
                                    </div>
                                </div>



                            </div>


                        </div>


                        </div>
                    </div>
                </div>

            <div class="form-actions fluid">
                <div class="row">
                    <div class="col-md-offset-3 col-md-9">
                        <input type="submit" id="submitEdit" value="حفظ" class="btn green " />
                        <a href="/TakeawayUsers/Index" class="btn default">للخلف</a>

                    </div>
                </div>
            </div>


           }
                    </div>
                </div>
            </div>









            @section Scripts {
                <script src="~/Scripts/Pages/TakeawayUsers.js"></script>
                @*@Scripts.Render("~/bundles/jqueryval")*@

<script>
                   $(document).ready(function () {
                       debugger;


                       if ($('#Roleddl option:selected').text() == "User") {
                           debugger;
                           //LoadUserData($("#HiddenUserID").val());
                           //var UserAddressList=[];
                           //var UserRegionNameList=[];
                           //var UserRegionList=[];
                           //var UserMapLatitudeList=[];
                           //var UserMapLongitudeList=[];

                           var UserAddressList=@Html.Raw(Json.Encode(Model.Address));
                           var UserRegionNameList=@Html.Raw(Json.Encode(Model.RegionName));
                           var UserRegionList=@Html.Raw(Json.Encode(Model.Region_id));
                           var UserMapLatitudeList=@Html.Raw(Json.Encode(Model.MapLatitude));
                           var UserMapLongitudeList=@Html.Raw(Json.Encode(Model.MapLongitude));

                           for (var a = 0; a < UserAddressList.length ; a++) {

                               UserData.push({
                                   count:UserData.length+1,
                                   Address: UserAddressList[a],
                                   Region_id: parseInt(UserRegionList[a]),
                                   Region_Name: UserRegionNameList[a],
                                   MapLatitude: UserMapLatitudeList[a],
                                   MapLongitude: UserMapLongitudeList[a],
                                   IsActive:true
                               });
                           }
                           fillsMMSMessageTable();

                           $('#UserDataDiv').css('display', 'table');
                       }
                       else {
                           $('#UserDataDiv').css('display', 'none');
                       }


                   });
                </script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5h1G8x0X-k7Kh9ufHzqtj2iYcZ-PVJa8&libraries=places&callback=initMap">
</script>
<script>
      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      var map, infoWindow;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: 24.089723515381433, lng: 38.04842233657837 },
          zoom: 17,
          mapTypeId: 'terrain'
        });
        //infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        //if (navigator.geolocation) {
        //  navigator.geolocation.getCurrentPosition(function(position) {
        //    var pos = {
        //      lat: position.coords.latitude,
        //      lng: position.coords.longitude
        //    };
          
        //  var marker = new google.maps.Marker({
        //      position: pos,
        //      map: map,
        //      //title: place.name,
        //      // position: place.geometry.location,
        //      animation: google.maps.Animation.BOUNCE
        //  });
        //   // debugger;
        //    //infoWindow.setPosition(pos);
        //    //infoWindow.setContent('Location found.');
        //   // infoWindow.open(map);
        //    map.setCenter(pos);

        //  }, function() {
        //    handleLocationError(true, infoWindow, map.getCenter());
        //  });
        //} else {
        //  // Browser doesn't support Geolocation
        //  handleLocationError(false, infoWindow, map.getCenter());
        //}
        google.maps.event.addListener(map, 'click', function (e) {
            $('#GMapLogitude').val(e.latLng.lng());
            $('#GMapLutitude').val(e.latLng.lat());

            //alert("Latitude: " + e.latLng.lat() + "\r\nLongitude: " + e.latLng.lng());
        });



          //==============================================
          //DM 21-8-2017 Search in GoogleMap
          // Create the search box and link it to the UI element.

        var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

          // Bias the SearchBox results towards current map's viewport.
        map.addListener('bounds_changed', function () {

            searchBox.setBounds(map.getBounds());
        });
        var markers = [];
          // Listen for the event fired when the user selects a prediction and retrieve
          // more details for that place.
        searchBox.addListener('places_changed', function () {

            var places = searchBox.getPlaces();

            if (places.length == 0) {
                return;
            }

            // Clear out the old markers.
            markers.forEach(function (marker) {
                marker.setMap(null);
            });
            markers = [];

            // For each place, get the icon, name and location.
            var bounds = new google.maps.LatLngBounds();
            places.forEach(function (place) {
                if (!place.geometry) {
                    console.log("Returned place contains no geometry");
                    return;
                }
                var icon = {
                    url: place.icon,
                    size: new google.maps.Size(71, 71),
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(17, 34),
                    scaledSize: new google.maps.Size(25, 25)
                };

                // Create a marker for each place.
                markers.push(new google.maps.Marker({
                    map: map,
                    icon: icon,
                    title: place.name,
                    position: place.geometry.location
                }));

                if (place.geometry.viewport) {
                    // Only geocodes have viewport.
                    bounds.union(place.geometry.viewport);
                } else {
                    bounds.extend(place.geometry.location);
                }
            });
            map.fitBounds(bounds);
        });

        $('#pac-input').keydown(function (event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                return false;
            }
        });



      }

      //function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      //  infoWindow.setPosition(pos);
      //  infoWindow.setContent(browserHasGeolocation ?
      //                        'Error: The Geolocation service failed.' :
      //                        'Error: Your browser doesn\'t support geolocation.');
      //  infoWindow.open(map);
      //}
</script>
        }
